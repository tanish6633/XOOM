<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Profit Calculator | Farm Central</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            background: #0f172a;
            color: white;
            font-family: 'Outfit', sans-serif;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .input-field {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 12px;
            color: white;
            outline: none;
            transition: all 0.3s;
        }

        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.2);
        }

        /* Global Interactive Hover Effects */
        button:hover,
        input:hover,
        .glass:hover,
        a:hover {
            transform: scale(1.02);
            transition: transform 0.2s ease-in-out;
            cursor: pointer;
        }
    </style>
</head>

<body class="p-6 md:p-12 min-h-screen relative overflow-x-hidden">
    <!-- Background -->
    <div id="canvas-bg" class="fixed inset-0 z-[-1] opacity-40"></div>

    <!-- Back Button -->
    <button onclick="window.history.back()"
        class="fixed top-6 left-6 z-50 w-12 h-12 rounded-full glass flex items-center justify-center text-white hover:bg-white/10 transition hover:scale-110 shadow-lg">
        ‚Üê
    </button>

    <div class="max-w-6xl mx-auto pl-12">
        <header class="flex justify-between items-center mb-10">
            <div>
                <h1
                    class="text-4xl font-black text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-500">
                    ROI ESTIMATOR</h1>
                <p class="text-slate-400">Projected Profit & Loss Calculator</p>
            </div>
            <!-- Hub Button Removed -->
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- INPUT FORM -->
            <div class="glass p-8 rounded-3xl h-full">
                <h3 class="text-xl font-bold mb-6 flex items-center gap-2">
                    <span class="bg-blue-500/20 text-blue-400 p-2 rounded-lg">üßÆ</span> Calculator
                </h3>

                <form id="calcForm" class="space-y-6">
                    <div>
                        <label class="block text-sm text-slate-400 mb-2">Select Crop</label>
                        <select id="crop" class="input-field cursor-pointer">
                            <option value="wheat">Wheat</option>
                            <option value="rice">Rice (Paddy)</option>
                            <option value="cotton">Cotton</option>
                            <option value="onion">Onion</option>
                            <option value="tomato">Tomato</option>
                            <option value="potato">Potato</option>
                        </select>
                    </div>

                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Land Size (Acres)</label>
                            <input type="number" id="area" value="5" class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm text-slate-400 mb-2">Yield (Qtl/Acre)</label>
                            <input type="number" id="yield" value="20" class="input-field">
                        </div>
                    </div>

                    <div>
                        <label class="block text-sm text-slate-400 mb-2">Cost of Cultivation (‚Çπ/Acre)</label>
                        <input type="number" id="cost" value="15000" class="input-field"
                            placeholder="Seeds, Labor, Fertilizer...">
                    </div>

                    <button type="button" onclick="calculate()"
                        class="w-full bg-blue-600 hover:bg-blue-500 py-4 rounded-xl font-bold tracking-wider shadow-lg shadow-blue-600/20 transition transform hover:scale-[1.02]">
                        CALCULATE PROFIT
                    </button>
                </form>
            </div>

            <!-- RESULTS -->
            <div id="result-card"
                class="glass p-8 rounded-3xl hidden border-l-4 border-green-500 flex flex-col justify-between">
                <div>
                    <h3 class="text-lg font-bold text-slate-300 mb-1">Projected Outcome</h3>
                    <p class="text-xs text-slate-500 mb-6">Based on live market prices</p>

                    <div class="grid grid-cols-2 gap-4 mb-8">
                        <div class="bg-white/5 p-4 rounded-xl">
                            <p class="text-xs text-slate-400 uppercase tracking-widest">Total Revenue</p>
                            <p class="text-2xl font-black text-green-400" id="res-revenue">‚Çπ0</p>
                        </div>
                        <div class="bg-white/5 p-4 rounded-xl">
                            <p class="text-xs text-slate-400 uppercase tracking-widest">Total Cost</p>
                            <p class="text-2xl font-black text-red-400" id="res-cost">‚Çπ0</p>
                        </div>
                    </div>

                    <div
                        class="text-center p-6 bg-gradient-to-br from-indigo-900/50 to-blue-900/50 rounded-2xl border border-white/10 relative overflow-hidden">
                        <div class="relative z-10">
                            <p class="text-sm font-bold text-blue-200 uppercase tracking-widest mb-2">Net Profit</p>
                            <h2 class="text-5xl font-black text-white drop-shadow-lg" id="res-profit">‚Çπ0</h2>
                            <p class="text-sm text-blue-300 mt-2 font-mono" id="res-roi">ROI: 0%</p>
                        </div>
                        <!-- Glow effect -->
                        <div class="absolute inset-0 bg-blue-500/10 blur-xl"></div>
                    </div>
                </div>

                <div class="mt-6 h-40">
                    <canvas id="profitChart"></canvas>
                </div>
            </div>

            <!-- Placeholder -->
            <div id="placeholder"
                class="glass p-8 rounded-3xl flex flex-col items-center justify-center text-slate-500 h-full opacity-50 border-2 border-dashed border-slate-700">
                <div class="text-6xl mb-4">üîÆ</div>
                <p>Enter details to estimate ROI</p>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        // --- 3D BG ---
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-bg').appendChild(renderer.domElement);

        // Abstract Shapes
        const geometry = new THREE.TetrahedronGeometry(10, 0);
        const material = new THREE.MeshBasicMaterial({ color: 0x3b82f6, wireframe: true, transparent: true, opacity: 0.1 });
        const mesh = new THREE.Mesh(geometry, material);
        scene.add(mesh);

        // Stars
        const starsGeo = new THREE.BufferGeometry();
        const starsCnt = 500;
        const posArray = new Float32Array(starsCnt * 3);
        for (let i = 0; i < starsCnt * 3; i++) posArray[i] = (Math.random() - 0.5) * 100;
        starsGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        const starsMat = new THREE.PointsMaterial({ size: 0.1, color: 'white' });
        const starMesh = new THREE.Points(starsGeo, starsMat);
        scene.add(starMesh);

        camera.position.z = 20;
        function animate() {
            requestAnimationFrame(animate);
            mesh.rotation.y += 0.002;
            mesh.rotation.x -= 0.002;
            starMesh.rotation.y -= 0.001;
            renderer.render(scene, camera);
        }
        animate();

        // --- CALCULATOR LOGIC ---
        let myChart = null;

        async function calculate() {
            const crop = document.getElementById('crop').value;
            const area = parseFloat(document.getElementById('area').value);
            const yieldPerAcre = parseFloat(document.getElementById('yield').value);
            const costPerAcre = parseFloat(document.getElementById('cost').value);

            if (!area || !yieldPerAcre || !costPerAcre) return alert("Please fill all fields");

            // 1. Fetch Price
            try {
                const res = await fetch(`/api/market/price/${crop}`);
                const data = await res.json();
                const pricePerQuintal = data.price; // This relies on our existing market route

                // 2. Calculate
                const totalYield = area * yieldPerAcre;
                const totalRevenue = totalYield * pricePerQuintal;
                const totalCost = area * costPerAcre;
                const netProfit = totalRevenue - totalCost;
                const roi = ((netProfit / totalCost) * 100).toFixed(1);

                // 3. Render
                document.getElementById('placeholder').classList.add('hidden');
                document.getElementById('result-card').classList.remove('hidden');

                document.getElementById('res-revenue').innerText = `‚Çπ${totalRevenue.toLocaleString()}`;
                document.getElementById('res-cost').innerText = `‚Çπ${totalCost.toLocaleString()}`;
                document.getElementById('res-profit').innerText = `‚Çπ${netProfit.toLocaleString()}`;
                document.getElementById('res-roi').innerText = `ROI: ${roi}%`;

                // Color coding
                const profitEl = document.getElementById('res-profit');
                if (netProfit > 0) {
                    profitEl.className = "text-5xl font-black text-green-400 drop-shadow-lg";
                    document.getElementById('result-card').classList.add('border-green-500');
                    document.getElementById('result-card').classList.remove('border-red-500');
                } else {
                    profitEl.className = "text-5xl font-black text-red-400 drop-shadow-lg";
                    document.getElementById('result-card').classList.add('border-red-500');
                    document.getElementById('result-card').classList.remove('border-green-500');
                }

                // Chart
                const ctx = document.getElementById('profitChart').getContext('2d');
                if (myChart) myChart.destroy();

                myChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Cost', 'Revenue', 'Profit'],
                        datasets: [{
                            label: 'Amount (‚Çπ)',
                            data: [totalCost, totalRevenue, netProfit],
                            backgroundColor: ['#ef4444', '#3b82f6', netProfit > 0 ? '#22c55e' : '#7f1d1d'],
                            borderRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        indexAxis: 'y',
                        plugins: { legend: { display: false } },
                        scales: { x: { grid: { display: false } }, y: { display: false } }
                    }
                });

            } catch (e) {
                alert("Failed to fetch market data. Please check connection.");
            }
        }
    </script>
    <script src="js/background-3d.js"></script>
    <script src="js/global-ticker.js"></script>
    <script src="js/mobile-nav.js"></script>
</body>

</html>